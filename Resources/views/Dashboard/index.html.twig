{% extends "ParabolAdminCoreBundle::base_admin_uncompressed.html.twig" %}

{% trans_default_domain "Admingenerator" %}

{#% block page_header_content %}<h1><span class="fa fa-dashboard" aria-hidden="true"></span> {% trans %}Dashboard{% endtrans %}</h1>{% endblock %#}

{% block page_content %}

{% if googleDashboard %}
  <div class="row" data-dashboard-widget="totalActivity">
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-aqua">
          <div class="inner">
            <h3 class="inject-preloader" data-dashboard-widget-key="avgSessionDuration"  data-dashboard-widget-type="raw"></h3>
            <p>{% trans %}Avg. Time{% endtrans %}</p>
          </div>
          <div class="icon">
            <i class="ion ion-ios-speedometer"></i>
          </div>
          <!--a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a-->
        </div>
      </div><!-- ./col -->
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-red">
          <div class="inner">
            <h3 class="inject-preloader"  data-dashboard-widget-key="bounceRate"  data-dashboard-widget-type="raw"></h3>
            <p>{% trans %}Bounce Rate{% endtrans %}</p>
          </div>
          <div class="icon">
            <i class="ion ion-stats-bars"></i>
          </div>
          <!--a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a-->
        </div>
      </div><!-- ./col -->
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box  bg-green">
          <div class="inner">
            <h3 class="inject-preloader" data-dashboard-widget-key="users"  data-dashboard-widget-type="raw"></h3>
            <p>{% trans %}Unique Visitors{% endtrans %}</p>
          </div>
          <div class="icon">
            <i class="ion ion-person-add"></i>
          </div>
          <!--a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a-->
        </div>
      </div><!-- ./col -->
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-yellow">
          <div class="inner">
            <h3 class="inject-preloader" data-dashboard-widget-key="pageviewsPerSession"  data-dashboard-widget-type="raw"></h3>
            <p>{% trans %}Pages/Visit{% endtrans %}</p>
          </div>
          <div class="icon">
            <i class="ion ion-pie-graph"></i>
          </div>
          <!--a href="#" class="small-box-footer">{% trans %}More info{% endtrans %} <i class="fa fa-arrow-circle-right"></i></a-->
        </div>
      </div><!-- ./col -->
  </div>	
  <div class="row"> 
  	<div class="col-md-6" data-dashboard-widget="weekActivity">    
  		<div class="box box-primary">
                  <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>
                    <h3 class="box-title">{% trans %}WebSite Weekly Activities{% endtrans %}</h3>
                  </div>
                  <div class="box-body">
                    <canvas id="siteWeeklyActivitiesChart" height="350" data-dashboard-widget-key="siteActivitiesWeekBeforeLastWeek,siteActivitiesLastWeek,siteActivitiesThisWeek" data-dashboard-widget-type="chart" data-chart-ds-type="points" ></canvas>
                    
               	</div>
               	<div class="box-footer">
               		<div class="row" data-dashboard-widget-key="_thisWeek,_lastWeek" data-dashboard-widget-type="container">
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" id="thisWeekBounceRate" data-type="%" data-max="100" data-value="0.1" data-dashboard-widget-key="thisWeek:bounceRate" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}This Week Bounce Rate{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="thisWeek:users" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}This Week Visitors{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge">
  		                  		<canvas width="90" height="50" data-type="s" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="thisWeek:avgSessionDuration" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}This Week Avg. Time{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	
  	                  	<div class="col-lg-4 clear-left">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" data-type="%" data-max="100" data-value="0.1" data-dashboard-widget-key="lastWeek:bounceRate" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}Last Week Bounce Rate{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="lastWeek:users" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}Last Week Visitors{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge">
  		                  		<canvas width="90" height="50" data-type="s" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="lastWeek:avgSessionDuration" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}Last Week Avg. Time{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                 </div>
               	</div>
          </div>
  	</div>
  	<div class="col-md-6 col-xs-12" data-dashboard-widget="yearActivity">    
  		<div class="box box-primary">
                  <div class="box-header with-border">
                    <i class="fa fa-bar-chart-o"></i>
                    <h3 class="box-title">{% trans %}WebSite Yearly Activities{% endtrans %}</h3>
                  </div>
                  <div class="box-body">
                    <canvas id="siteYearlyActivitiesChart" height="350" data-dashboard-widget-key="siteActivitiesLastYear,siteActivitiesThisYear" data-dashboard-widget-type="chart" data-chart-ds-type="bars"></canvas>
                  </div>
                  <div class="box-footer">
               		<div class="row" data-dashboard-widget-key="_thisYear,_lastYear" data-dashboard-widget-type="container">
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" data-type="%" data-max="100" data-value="0.1" data-dashboard-widget-key="thisYear:bounceRate" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}This Year Bounce Rate{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="thisYear:users" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}This Year Visitors{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge">
  		                  		<canvas width="90" height="50" data-type="s" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="thisYear:avgSessionDuration" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}This Year Avg. Time{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	
  	                  	<div class="col-lg-4 clearfix clear-left">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" data-type="%" data-max="100" data-value="0.1" data-dashboard-widget-key="lastYear:bounceRate" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}Last Year Bounce Rate{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge border-right">
  		                  		<canvas width="90" height="50" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="lastYear:users" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}Last Year Visitors{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                  	<div class="col-lg-4">
  	                  		<div class="gauge">
  		                  		<canvas width="90" height="50" data-type="s" data-color-start="#00a65a" data-color-stop="#00a65a" data-max="100" data-value="0.1" data-dashboard-widget-key="lastYear:avgSessionDuration" data-dashboard-widget-type="gauge"></canvas>
  		                  		<div class="label"></div>
  		                  		<div class="knob-label">{% trans %}Last Year Avg. Time{% endtrans %}</div>
  	                  		</div>
  	                  	</div>
  	                 </div>
               	</div>
          </div>
  	</div>
  	<div class="col-md-6">    
  		<div class="box" data-dashboard-widget="topSitesActivity">
                  <div class="box-header">
                    <h3 class="box-title">{% trans %}Most Popular WebPages{% endtrans %}</h3>
                  </div><!-- /.box-header -->
                  <div class="box-body no-padding">
                    <table class="table table-striped">
                      <tbody><tr>
                        <th style="width: 10px">#</th>
                        <th>{% trans %}Title / Path{% endtrans %}</th>
                        <th style="text-align: center">{% trans %}Page Views{% endtrans %}</th>
                      </tr>
                      <tr data-dashboard-widget-key="topSites" data-dashboard-widget-type="table">
                        <td colspan="3" style="text-align: center; padding: 30px 0" class="inject-preloader" data-color="dark"></td>
                      </tr>
                      {#% for site in topSites %}
                      <tr>
                        <td>{{ loop.index }}.</td>
                        <td><span class="text-info">{{ site[1] }}</span> <small>{{ site[0] }}</small></td>
                        <td style="text-align: center"><span class="badge bg-info">{{ site[2] }}</span></td>
                      </tr>
                      {% endfor %#}
                    </tbody></table>
                  </div><!-- /.box-body -->
                </div>

  	</div>
  	<div class="col-md-6">    
  		<div class="box" data-dashboard-widget="topPostsActivityUnique">
                  <div class="box-header">
                    <h3 class="box-title">{% trans %}Most Popular WebPages{% endtrans %} ({% trans %}Unique pageviews{% endtrans %})</h3>
                  </div><!-- /.box-header -->
                  <div class="box-body no-padding">
                    <table class="table table-striped">
                      <tbody><tr>
                        <th style="width: 10px">#</th>
                        <th>{% trans %}Title / Path{% endtrans %}</th>
                        <th style="text-align: center">{% trans %}Posts Views{% endtrans %}</th>
                      </tr>
                      <tr data-dashboard-widget-key="topSites" data-dashboard-widget-type="table">
                        <td colspan="3" style="text-align: center; padding: 30px 0" class="inject-preloader" data-color="dark"></td>
                      </tr>
                      {#% for site in topPosts %}
                      <tr>
                        <td>{{ loop.index }}.</td>
                        <td><span class="text-info">{{ site[1] }}</span> <small>{{ site[0] }}</small></td>
                        <td style="text-align: center"><span class="badge bg-info">{{ site[2] }}</span></td>
                      </tr>
                      {% endfor %#}
                    </tbody></table>
                  </div><!-- /.box-body -->
                </div>

  	</div>
  </div>
  {# <button class="print-button">Print</button>              #}	
  <script>

 
  $('.print-button').click(function(){
    $('.left-side').hide();
    $('.content-wrapper').css('margin-left', 0);
    $(this).hide();
    setTimeout(function(){
        $('.left-side').show();
        $('.content-wrapper').css('margin-left', '230px');
        $('.print-button').show();
    }, 1000);
    window.print();
  })



  var siteYearlyActivitiesChart;
  var siteWeeklyActivitiesChart;
  var widgets = {};

  var gaugeOpt = {
      lines: 12, // The number of lines to draw
      angle: 0.1, // The length of each line
      lineWidth: 0.44, // The line thickness
      pointer: {
        length: 0.84, // The radius of the inner circle
        strokeWidth: 0.035, // The rotation offset
        color: '#000000' // Fill color
      },
      limitMax: 'true',   // If true, the pointer will not go past the end of the gauge
      //percentColors: [[0.0, '#4ebd74'],[0.5, '#f4e32b'],[1.0, '#de0e1d']],   // Colors
      strokeColor: '#E0E0E0',   // to see which ones work best for you
      generateGradient: true
    };

  $('document').ready(function(){




  	{% set maxWeekActivity = 0 %}
  	{% set maxYearActivity = 0 %}

  var chartsData = {
  {#
  	
  		'siteActivitiesLastWeek': [ {% for n in siteActivitiesLastWeek %}{{ (loop.index > 1 ? ',' : '') ~ n[1] }}{% set maxWeekActivity = maxWeekActivity < n[1] ? n[1] : maxWeekActivity %}{% endfor %} ],
  		'siteActivitiesThisWeek': [ {% for n in siteActivitiesThisWeek %}{{ (loop.index > 1 ? ',' : '') ~ n[1] }}{% set maxWeekActivity = maxWeekActivity < n[1] ? n[1] : maxWeekActivity %}{% endfor %} ],
  		'siteActivitiesLastYear': [ {% for n in siteActivitiesLastYear %}{{ (loop.index > 1 ? ',' : '') ~ n[1] }}{% set maxYearActivity = maxYearActivity < n[1] ? n[1] : maxYearActivity %}{% endfor %} ],
  		'siteActivitiesThisYear': [ {% for n in siteActivitiesThisYear %}{{ (loop.index > 1 ? ',' : '') ~ n[1] }}{% set maxYearActivity = maxYearActivity < n[1] ? n[1] : maxYearActivity %}{% endfor %} ]

  #}	
  }
    var maxChartData = {
      'maxWeekActivity': 100,
      'maxYearActivity': 100
     {# 
      'maxWeekActivity': {{ maxWeekActivity }},
      'maxYearActivity': {{ maxYearActivity }}
      #}
    }
  	var weekLabels = [];
  	var weekDate = moment().startOf('week');
  	for (i=0;i<7;i++)
  	{
  		weekLabels.push(weekDate.add(i ? 1 : 0, 'days').format('ddd'))
  	}


  	var monthLabels = [];
  	var monthDate = moment().startOf('year');
  	for (i=0;i<12;i++)
  	{
  		monthLabels.push(monthDate.add(i ? 1 : 0, 'months').format('MMM'))
  	}	

  	$('#siteWeeklyActivitiesChart').attr('width', $('#siteWeeklyActivitiesChart').parent().width());
  	$('#siteYearlyActivitiesChart').attr('width', $('#siteYearlyActivitiesChart').parent().width());



  	var ctxWeek = document.getElementById("siteWeeklyActivitiesChart").getContext("2d");
  	var ctxYear = document.getElementById("siteYearlyActivitiesChart").getContext("2d");

  	var dataWeek = {
  	    labels: weekLabels,
  	    datasets: [
          {
                label: "Week Before Last Week",
                fillColor: "rgba(55, 50, 80,0.6)",
                strokeColor: "rgba(55, 50, 80,1)",
                pointColor: "rgba(55, 50, 80,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(55, 50, 80,1)",
                data: [0,0,0,0,0,0,0]
            },
  	    	{
  	            label: "Last Week",
  	            fillColor: "rgba(99, 194, 222,0.6)",
  	            strokeColor: "rgba(99, 194, 222,1)",
  	            pointColor: "rgba(99, 194, 222,1)",
  	            pointStrokeColor: "#fff",
  	            pointHighlightFill: "#fff",
  	            pointHighlightStroke: "rgba(99, 194, 222,1)",
  	            data: [0,0,0,0,0,0,0]
  	        },
  	        {
  	            label: "This Week",
  	            fillColor: "rgba(77, 189, 116,0.6)",
  	            strokeColor: "rgba(77, 189, 116,1)",
  	            pointColor: "rgba(77, 189, 116,1)",
  	            pointStrokeColor: "#fff",
  	            pointHighlightFill: "#fff",
  	            pointHighlightStroke: "rgba(77, 189, 116,1)",
  	            data: [0,0,0,0,0,0,0]
  	        }
  	        
  	    ]
  	};

  	var dataYear = {
  	    labels: monthLabels,
  	    datasets: [
  	    	  {
  	            label: "Last Year",
  	            fillColor: "rgba(99, 194, 222,0.9)",
  	            strokeColor: "rgba(99, 194, 222,1)",
  	            pointColor: "rgba(99, 194, 222,1)",
  	            pointStrokeColor: "#fff",
  	            pointHighlightFill: "#fff",
  	            pointHighlightStroke: "rgba(99, 194, 222,1)",
  	            data: [0,0,0,0,0,0,0,0,0,0,0,0]
  	        },
  	        {
  	            label: "This Year",
  	            fillColor: "rgba(77, 189, 116,0.9)",
  	            strokeColor: "rgba(77, 189, 116,1)",
  	            pointColor: "rgba(77, 189, 116,1)",
  	            pointStrokeColor: "#fff",
  	            pointHighlightFill: "#fff",
  	            pointHighlightStroke: "rgba(77, 189, 116,1)",
  	            data: [0,0,0,0,0,0,0,0,0,0,0,0]
  	        }
  	        
  	    ]
  	};

  	var lineOptions = {
  		animation: true,
  		scaleOverride: true,
  		scaleSteps: 5,
  		scaleStepWidth: Math.round(maxChartData.maxWeekActivity / 40) * 10,
  		scaleStartValue: 0,
  	    ///Boolean - Whether grid lines are shown across the chart
  	    scaleShowGridLines : true,

  	    //String - Colour of the grid lines
  	    scaleGridLineColor : "rgba(0,0,0,.05)",

  	    //Number - Width of the grid lines
  	    scaleGridLineWidth : 1,

  	    //Boolean - Whether to show horizontal lines (except X axis)
  	    scaleShowHorizontalLines: true,

  	    //Boolean - Whether to show vertical lines (except Y axis)
  	    scaleShowVerticalLines: false,

  	    //Boolean - Whether the line is curved between points
  	    bezierCurve : true,

  	    //Number - Tension of the bezier curve between points
  	    bezierCurveTension : 0.4,

  	    //Boolean - Whether to show a dot for each point
  	    pointDot : true,

  	    //Number - Radius of each point dot in pixels
  	    pointDotRadius : 4,

  	    //Number - Pixel width of point dot stroke
  	    pointDotStrokeWidth : 1,

  	    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
  	    pointHitDetectionRadius : 20,

  	    //Boolean - Whether to show a stroke for datasets
  	    datasetStroke : true,

  	    //Number - Pixel width of dataset stroke
  	    datasetStrokeWidth : 2,

  	    //Boolean - Whether to fill the dataset with a colour
  	    datasetFill : true,

  	    //String - A legend template
  	    

  	};

  	var barOptions = {
  		scaleOverride: true,
  		scaleSteps: 5,
  		scaleStepWidth: Math.round(maxChartData.maxYearActivity / 40) * 10,

  	    //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
  	    scaleBeginAtZero : true,

  	    //Boolean - Whether grid lines are shown across the chart
  	    scaleShowGridLines : true,

  	    //String - Colour of the grid lines
  	    scaleGridLineColor : "rgba(0,0,0,.05)",

  	    //Number - Width of the grid lines
  	    scaleGridLineWidth : 1,

  	    //Boolean - Whether to show horizontal lines (except X axis)
  	    scaleShowHorizontalLines: true,

  	    //Boolean - Whether to show vertical lines (except Y axis)
  	    scaleShowVerticalLines: false,

  	    //Boolean - If there is a stroke on each bar
  	    barShowStroke : true,

  	    //Number - Pixel width of the bar stroke
  	    barStrokeWidth : 2,

  	    //Number - Spacing between each of the X value sets
  	    barValueSpacing : 5,

  	    //Number - Spacing between data sets within X values
  	    barDatasetSpacing : 1,

  	    //String - A legend template


  	}

  	    

  	siteWeeklyActivitiesChart = new Chart(ctxWeek).Line(dataWeek, lineOptions);


  	// options.scaleStepWidth = Math.round(maxChartData.maxYearActivity / 40) * 10;


  	siteYearlyActivitiesChart = new Chart(ctxYear).Bar(dataYear, barOptions);


  	
  	// var target = document.getElementById('bounceRateLastWeek'); // your canvas element
  	// var gauge = new Gauge(target).setOptions(opts); // create sexy gauge!
  	// gauge.maxValue = 100; // set max gauge value
  	// gauge.animationSpeed = 32; // set animation speed (32 is default value)
  	// // gauge.setTextField();
  	// gauge.set(99); // set actual value

  	// console.log(document.getElementById('bounceRateLastWeek'));
  	$('.gauge canvas').gauge(gaugeOpt)
    $('.inject-preloader').injectPreader();


    $('div[data-dashboard-widget]').each(function(){
      // widgets[$(this).data('widget')] = $(this)
      
      $.get(sf_env + '/admin/dashboard/' + $(this).data('dashboard-widget') + '/data', function(jdata){
          
          addDashboardData($('div[data-dashboard-widget='+jdata.widget+']'), jdata.data);
          // console.log(jdata.data)
          
          // var $dataContainer = $('canvas[data-dashboard-widget-key="lastWeek:avgSessionDuration"]')
          // $dataContainer.data('value', jdata.data.lastWeek.avgSessionDuration.value)
          // $dataContainer.data('max', jdata.data.lastWeek.avgSessionDuration.max)
          // $dataContainer.gauge(gaugeOpt);
          // var $dataContainer = $('canvas[data-dashboard-widget-key="lastWeek:users"]')
          // $dataContainer.data('value', jdata.data.lastWeek.users.value)
          // $dataContainer.data('max', jdata.data.lastWeek.users.max)
          // $dataContainer.gauge(gaugeOpt);
          // var $dataContainer = $('canvas[data-dashboard-widget-key="lastWeek:bounceRate"]')
          // $dataContainer.data('value', jdata.data.lastWeek.bounceRate.value)
          // $dataContainer.data('max', jdata.data.lastWeek.bounceRate.max)
          // $dataContainer.gauge(gaugeOpt);
          // var $dataContainer = $('canvas[data-dashboard-widget-key="thisWeek:avgSessionDuration"]')
          // $dataContainer.data('value', jdata.data.thisWeek.avgSessionDuration.value)
          // $dataContainer.data('max', jdata.data.thisWeek.avgSessionDuration.max)
          // $dataContainer.gauge(gaugeOpt);
          // var $dataContainer = $('canvas[data-dashboard-widget-key="thisWeek:users"]')
          // $dataContainer.data('value', jdata.data.thisWeek.users.value)
          // $dataContainer.data('max', jdata.data.thisWeek.users.max)
          // $dataContainer.gauge(gaugeOpt);
          // var $dataContainer = $('canvas[data-dashboard-widget-key="thisWeek:bounceRate"]')
          // $dataContainer.data('value', jdata.data.thisWeek.bounceRate.value)
          // $dataContainer.data('max', jdata.data.thisWeek.bounceRate.max)
          // $dataContainer.gauge(gaugeOpt);

      }, 'json'); 
    })

    function addDashboardData(container, jdata, prefix)
    {
        for (key in jdata)
        {
          var k = (prefix != undefined ? prefix + ':' : '') + key
          $dataContainer = container.find('*[data-dashboard-widget-key*="'+k+'"]');
          if($dataContainer.length)
          {
            // console.log('widget type: ' + $dataContainer.data('dashboard-widget-type'));
            switch($dataContainer.data('dashboard-widget-type'))
            {
              case 'chart':
                var chart = window[$dataContainer.attr('id')]
                if(chart.currentDataset == undefined) chart.currentDataset = 0;
                var max = chart.scale.max;
                for(i in jdata[key])
                {
                  max = (max < jdata[key][i][1] ? jdata[key][i][1] : max)
                  chart.datasets[chart.currentDataset][$dataContainer.data('chart-ds-type')][i].value = jdata[key][i][1];
                } 
                max = Math.round(max / 40) * 50,

                chart.scale.max = max
                chart.scale.stepValue = max / 5
                chart.currentDataset++;
                chart.update();
                break;
              case 'gauge':
                $dataContainer.data('value', jdata[key]['value'])
                $dataContainer.data('max', jdata[key]['max'])
                $dataContainer.gauge(gaugeOpt);
              break;
              case 'container':
                addDashboardData($dataContainer, jdata[k], k.substr(1))
                break;      
              case 'table':
                var code =''
                for(i in jdata[key])
                {
                    // console.log(jdata[key][i]);
                    code += '<tr><td>'+(i+1)+'.</td><td><span class="text-info">'+ jdata[key][i][1] +'</span> <small>'+ jdata[key][i][0] +'</small></td><td style="text-align: center"><span class="badge bg-info">'+ jdata[key][i][2] +'</span></td></tr>'                       
                }
                $dataContainer.replaceWith(code);
              default: 
                $dataContainer.html(jdata[key]);  
            }
          } 
        }
    }

  })

  $.fn.injectPreader = function()
  {
    this.each(function(){
      var img = $(this).data('color') == 'dark' ? '{{ asset('bundles/paraboladmincore/images/preloaders/loading-spin-dark.svg') }}' : '{{ asset('bundles/paraboladmincore/images/preloaders/loading-spin.svg') }}'
      $(this).removeClass('inject-preloader').html('<img src="'+img+'" alt="Loading..." />');
    })
  }

  $.fn.gauge = function(opts) {
    this.each(function() {
      var $this = $(this),
          data = $this.data();

      if (data.gauge) {
        delete data.gauge;
      }
      if (opts !== false) {

     	  opts.colorStart = $this.data('color-start') ? $this.data('color-start') : '#b2101d'
    	  opts.colorStop = $this.data('color-stop') ? $this.data('color-stop') : '#e2213c'
    	  data.gauge = new Gauge(this).setOptions(opts);
        data.gauge.maxValue = parseFloat($this.data('max'));
        data.gauge.animationSpeed = 32;
        data.gauge.set(parseFloat($this.data('value')))
        var $label = $this.parent().find('.label')
        if($label.length)
        {
        	if($this.data('type') == '%') $label.addClass('label-percent')
        	else if($this.data('type') == 's') $label.addClass('label-seconds')

        	data.gauge.setTextField($label.get( 0 ));

          $label.injectPreader();
        }
      }
    });
    return this;
  };


  </script>

{% else %}

<div class="alert alert-warning alert-dismissable">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <h4><i class="icon fa fa-info"></i>Pulpit Google Analitics</h4>
                    Aby włączyć dashbord ze statystykami z Google Analitics uzupełnij pola (<b><i>Identyfikator widoku danych</i></b>, ) w sekcji <a href="{{ path('parabol_admin_core_setting') }}">Ustawienia</a>
                  </div>

  

{% endif %}

{% endblock %}
